# MAT3123

**final_project 2018143507 박문수** 

## 목차
1. [개요](#1개요)
2. [setup_environment](#2setup_environment)
3. [data_fetch](#3data_fetch)
4. [preprocessing](#4preprocessing)
5. [model_training](#5model_training)
6. [generate_predictions](#6generate_predictions)
7. [result_analysis](#7result_analysis)
8. [실제 2024 골든글러브 수상 결과](#8실제-2024-골든글러브-수상-결과)
9. [한계점](#9한계점)
    
## 1.개요

2024년 한국 프로야구 열풍이 불면서 1000만관객이라는 이전까지 없던 대기록까지 세우게 되었습니다.

저도 작년까지 응원 팀(SSG) 경기를 직접 찾아본다기 보다는 경기 결과만 확인하는 정도의 관심만 가졌었는데, 2024년에 들어 야구장 직관도 가보고 응원가도 불러보면서 야구에 대한 재미를 많이 느끼게 되었고, 이와 관련해 프로젝트를 진행해보고 싶다는 생각을 가지게 되었습니다.

마침 현재 골든글러브 시상을 앞두고 있는 시기라서 선수들의 기록을 보고 어떤 선수들이 골든글러브 수상을 할지 예측해보는 머신러닝 모델을 만드는 프로젝트를 계획하게 되었습니다.

상세 구현 내용은 아래과 같습니다.

## 2.setup_environment

- `bs4`, `beautifulsoup4`: HTML 파싱을 위한 BeautifulSoup 라이브러리.
- `requests`: HTTP 요청을 보내 웹 데이터를 가져오기 위한 라이브러리.
- `pandas`: 데이터를 DataFrame 형태로 다루기 위한 라이브러리.
- `selenium`: 브라우저 자동화를 위한 라이브러리.
- `webdriver-manager`: Selenium의 WebDriver를 자동으로 설치/관리하기 위한 라이브러리.
- `webdriver`: Selenium에서 브라우저 조작에 사용.
- `BeautifulSoup`: HTML을 파싱해 DOM 구조를 쉽게 탐색 및 추출.
- `Service`: WebDriver 실행을 관리.
- `ChromeDriverManager`: ChromeDriver를 자동 설치 및 관리.

위처럼 데이터 파싱 및 처리를 위한 라이브러리를 install, 필요한 모듈을 import하고, 실행 환경을 설정하였습니다.

## 3.data_fetch

- 선수들 데이터를 활용하기 위해 statiz라는 사이트에서 18~23년의 각 선수들에 대한 정보를 크롤링했습니다.  18년도부터 크롤링 한 이유는 현재 골든글러브 후보 기준이 18년도부터 사용하고 있는 기준을 사용하기 때문이었습니다. 여기에는 선수 이름, 포지션, WAR, PA, AVG 등의 정보가 들어가 있습니다. (url list에 저장)
- url 리스트에서 대상 웹 페이지의 내용을 파싱해 BuaitofulSoup객체로 변환, 필요한 정보(선수들 데이터)가 있는 table요소를 찾아왔습니다. 이후 실제 사이트에 나온 데이터 순서대로 column이름을 만들어 저장했습니다.
- 이를 모든 url 리스트에 대해 반복하여 리스트에 저장, dataframe으로 변환했습니다.

## 4.preprocessing

- <img>
- 먼저 결측치에 해당하는 값을 확인하기 위해 df.info()를 사용했습니다. → 결측치가 없어 결측치를 처리해줄 필요가 없었습니다.
- 이후 골든글러브 평가 요소와 관련 없는 선수 index, 이름, 팀이름을 먼저 drop해주었습니다.
- <img>
- 남은 feature들이 아직 많기 때문에 서로 연관이 큰 feature들을 찾고자, heatmap을 만들었습니다. 이때, 너무 많은 feature로 인해 heatmap이 크고 복잡하게 나와있어 상관관계에 대한 threshold = 0.8로 설정하여 서로 연관이 큰 feature에 대해 확인하고, 몇 개를 drop하여 feature 수를 줄이고 학습하기 용이하게 만들었습니다.
    - oWAR, WAR 끼리 상관관계가 높음 -> oWAR제거
    - PA, ePA, AB 간의 상관관계가 높음 -> PA, AB 제거
    - OPS, R/ePA, SLG, wRC+ 간의 상관관계가 높음 -> R/ePA, SLG 제거
- 마지막으로 실제 골든글러브를 수상한 사람들을 Golden이라는 column을 만들어 직접 추가하였습니다. (받은 사람 : 1, 못 받은 사람 : 0)

## 5.model_training

- **`KFold`**: K-Fold 교차 검증을 위해 사용.
- **`SMOTE`**: 데이터 불균형을 완화하기 위해 샘플링 기법 사용.
- **`LogisticRegression`**: 로지스틱 회귀 모델.
- Golden 열을 타겟 변수로 설정하였습니다.
- k-Fold 교차 검증을 이용하여 데이터를 5개 폴드로 분할하고 랜덤하게 섞었습니다.
- 로지스틱 회귀 모델은 최대 반복 횟수 1000(수렴 방지)로 고정시켰고, C( 규제 강도)를 10, 1, 0.1, 0.01로 변경해보면서 training을 진행해보았습니다.
- 규제 강도 : 값이 클 수록 강한 규제, 작을 수록 약한 규제를 적용, **강한 규제**를 적용하면 모델이 단순해져 과적합은 방지하지만 데이터 패턴을 충분하지 못하게 잡아낼 수 있어서 **과소적합 발생 가능**, 반대로 **강한 규제**는 데이터의 노이즈까지 학습하여 **과적합 발생** **가능**하다.
- 이 방식으로 model의 accuracy와 정밀도, 재현율, F1 score 등의 평가 결과를 출력해 보았습니다.

## 6.generate_predictions

- 각 포지션별로 선수 데이터를 파싱할 수 있도록 url list를 미리 생성해놨습니다.
- data_fetch와 마찬가지로 url를 반복 처리 하면서 선수들에 대한 데이터를 파싱, 필요 없는 데이터를 drop해두었습니다.
- 학습된 모델을 사용해 골든글러브 수상 가능성의 확률을 Golden_Probability열에 추가했습니다.
- 가장 높은 확률을 가진 선수의 index를 찾아 해당 선수의 이름을 출력하도록 만들었습니다.
- C 값 별로 accuracy와 예측한 선수의 명단은 아래와 같습니다.

|  | accuracy | 포수 | 1루수 | 2루수 | 3루수 | 유격수 | 좌익수 | 중견수 | 우익수 | 지명타자 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| C = 10 | 0.78 | 양의지 | 오스틴 | 김혜성 | 김도영 | 박성한 | 에레디아 | 윤동희 | 로하스 | 김재환 |
| C = 1 | 0.81 | 양의지 | 오스틴 | 김혜성 | 김도영 | 박성한 | 에레디아 | 윤동희 | 로하스 | 전준우 |
| C = 0.1 | 0.84 | 양의지 | 오스틴 | 김혜성 | 김도영 | 박성한 | 에레디아 | 정수빈 | 로하스 | 전준우 |
| C = 0.01 | 0.86 | 양의지 | 오스틴 | 김혜성 | 김도영 | 박찬호 | 구자욱 | 김지찬 | 로하스 | 전준우 |

## 7.result_analysis

- 학습된 로지스틱 회귀 모델의 가중치의 절대값을 사용해 중요도를 측정하였습니다. (가중치가 클 수록 영향이 크다)
- 이를 중요도에 따라 내림차순 sorting하여 어떤 feature가 중요한지 알아보고 출력해보았습니다. 그 결과는 아래와 같습니다.
- <img>

## 8.실제 2024 골든글러브 수상 결과

- 12/13 발표된 실제 골든글러브 수상 결과는 아래와 같습니다.

| 포수 | 1루수 | 2루수 | 3루수 | 유격수 | 좌익수 | 중견수 | 우익수 | 지명타자 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 강민호 | 오스틴 | 김혜성 | 김도영 | 박찬호 | 구자욱 | 레이예스 | 로하스 | 최형우 |
- 모델이 예측한 결과 중 accuracy가 가장 높았던 C=0.01일 때의 결과가 실제 2024 골든글러브 수상 결과를 가장 많이 맞춘 것으로 확인되었습니다. (3명 예측 실패)

## 9.한계점

- 타자의 경우는 모든 포지션들이 WAR, 타율, 출루율 등의 공통 feature들을 가지고 있어 학습이 편했지만, 투수같은 경우 feature 타자와 완전히 다르기 때문에 학습하기 어려웠습니다.
- 투수는 타자와 다르게 매년 1명씩 수상하기 때문에 수상자 수가 매우 적어 학습을 진행할 수 없었습니다.
- KBO의 역사가 너무 짧기 때문에 표본이 적었습니다. 표본이 더 많이 쌓인다면 더 올바른 예측을 할 수 있을 것입니다.
- 실제 골든글러브 수상자 결정은 데이터 기반으로 수상자를 결정하는 것이 아닌 주관적인 생각이 들어가 오차가 발생할 가능성이 컸습니다. 여론이나 우승팀 프리미엄 등의 지표를 추가하여 가중치를 매기면 더 좋은 결과가 나올 것이라 예상됩니다. (주관적 기준들을 수치화해서 최적의 선택을 하는 AHP 방식을 사용하면 좋을 것 같습니다.)
